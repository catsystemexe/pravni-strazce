<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Právní strážce – FIX run (2025-11-29T19:00:55Z)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 2rem;
            line-height: 1.5;
            background: #0f172a;
            color: #e5e7eb;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #020617;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid #1f2937;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .meta {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-bottom: 0.5rem;
        }

    </style>
</head>
<body>
    <h1>Právní strážce – FIX run</h1>
    <div class="meta">
      Tento soubor generuje GitHub Action z repozitáře catsystemexe/pravni-strazce.
      (UTC: 2025-11-29T19:00:55Z)
    </div>
    <pre>================================================================================
ODPOVĚĎ CODING AGENTA:

### 1. Co chápu ze struktury projektu

- Jde o core framework pro právního asistenta „Právní strážce“.
- Právní logika je rozdělená do modulů (`engines/*`): core_legal, judikatura, risk, safety, intent engine apod.
- Doménové znalosti jsou v:
  - `engines/domain_rules/*.yaml` – pravidla pro právní domény (školské, trestní, rodinné atd.).
  - `data/_source/domains/*` – zdrojové doménové definice a intent JSONy (např. `traffic_law/intents/*.json`).
- Běhové intent definice se načítají z `data/intents/**` (viz `engines/intent/loader.py`), což je generovaný / runtime adresář, odlišný od `_source`.
- V `tools/` jsou pomocné skripty pro generování/opravy intentů a validity (`generate_intent_from_domains.py`, `bootstrap_traffic_law_intents.py`, `fix_intent_pipeline_v1.py`, `generate_intents_from_yaml.py`, `validate_intents.py`).
- CI workflow `.github/workflows/run-agent.yml` (není v dumpu, ale víme, že obsahuje step „Apply FIX script (traffic_law intents)“ volající `tools/fix_intent_pipeline_v1.py`).

Tvůj aktuální úkol je čistě technický:
- vytvořit nový nástroj pro zajištění adresářů `data/intents/&lt;domain&gt;/` s `.keep`,
- upravit v CI workflow jeden konkrétní step, aby volal nový skript.

---

### 2. Návrh konkrétních kroků k úkolu (skript + workflow)

#### 2.1. Nový skript `tools/fix_create_intent_runtime_dirs.py`

1. **Vytvořit soubor** `tools/fix_create_intent_runtime_dirs.py` se strukturou:

   ```python
   #!/usr/bin/env python
   from __future__ import annotations

   import os
   from pathlib import Path


   DOMAINS = [
       &quot;school_law&quot;,
       &quot;debt_law&quot;,
       &quot;environmental_law&quot;,
       &quot;property_construction_law&quot;,
       &quot;social_law&quot;,
       &quot;media_ip_law&quot;,
       &quot;constitutional_law&quot;,
       &quot;family_law&quot;,
       &quot;data_digital_law&quot;,
       &quot;labor_law&quot;,
       &quot;health_law&quot;,
       &quot;tax_law&quot;,
       &quot;administrative_law&quot;,
       &quot;inheritance_law&quot;,
       &quot;criminal_law&quot;,
       &quot;traffic_law&quot;,
       &quot;corporate_law&quot;,
       &quot;civil_law&quot;,
       &quot;consumer_finance_law&quot;,
       &quot;international_law&quot;,
   ]


   def ensure_runtime_intent_dirs(base_dir: Path) -&gt; None:
       &quot;&quot;&quot;
       Idempotentně zajistí existenci:

       - base_dir (typicky data/intents)
       - base_dir/&lt;domain&gt; pro všechny DOMAINS
       - base_dir/&lt;domain&gt;/.keep (prázdný soubor, pokud neexistuje)

       Nic nepřepisuje, jen vytváří, pokud chybí.
       &quot;&quot;&quot;
       base_dir.mkdir(parents=True, exist_ok=True)

       for domain in DOMAINS:
           domain_dir = base_dir / domain
           domain_dir.mkdir(parents=True, exist_ok=True)

           keep_file = domain_dir / &quot;.keep&quot;
           if not keep_file.exists():
               # vytvoří prázdný soubor, pokud ještě není
               keep_file.touch()


   def main() -&gt; None:
       repo_root = Path(__file__).resolve().parent.parent
       base_dir = repo_root / &quot;data&quot; / &quot;intents&quot;

       ensure_runtime_intent_dirs(base_dir)

       # jednoduchý log pro přesměrování do tmp/last_report.txt
       print(f&quot;[fix_create_intent_runtime_dirs] Ensured runtime dirs in: {base_dir}&quot;)

       for domain in DOMAINS:
           print(f&quot;  - {domain}&quot;)


   if __name__ == &quot;__main__&quot;:
       main()
   ```

   Poznámky:
   - `Path(__file__).resolve().parent.parent` vychází z toho, že `tools/` je přímo v kořeni repa.
   - Operace jsou idempotentní:
     - `mkdir(..., exist_ok=True)` – nevytváří konflikt, pokud adresář existuje.
     - `.touch()` se volá only-if-not-exists – nezasahuje do existujících `.keep` nebo jiných souborů.
   - Skript má jednoduchý textový výstup, aby dávalo smysl přesměrování do `tmp/last_report.txt`.

#### 2.2. Úprava workflow `.github/workflows/run-agent.yml`

2. **Otevřít `.github/workflows/run-agent.yml`** a najít step:

   ```yaml
   - name: Apply FIX script (traffic_law intents)
     run: python tools/fix_intent_pipeline_v1.py &gt;&gt; tmp/last_report.txt
   ```

3. **Nahradit pouze řádek `run:`** tímto:

   ```yaml
   - name: Apply FIX script (traffic_law intents)
     run: python tools/fix_create_intent_runtime_dirs.py &gt;&gt; tmp/last_report.txt
   ```

   - Název stepu, další kroky a vše okolo ponechat beze změny.
   - Tím zajistíš, že při CI běhu se před dalšími nástroji vždy vytvoří struktura `data/intents/**`.

---

### 3. Dopady a návrhy na architekturu / data (nad rámec úkolu)

1. **Formální dokotvení runtime vs. source dat pro intents**
   - V `docs/intent.system.md` doplnit:
     - jasný popis, že:
       - `_source/domains/**` = master zdroj pro domény a jejich intent definice,
       - `data/intents/**` = běhové / zkompilované intent definice, které načítá `engines/intent/loader.py`.
     - stručnou zmínku o novém skriptu `tools/fix_create_intent_runtime_dirs.py` jako kroku, který připravuje adresářovou strukturu (může být i v sekci „CI / build pipeline“).

2. **Konzistence seznamu domén**
   - V doménovém katalogu (`runtime/domain_catalog.py` a `docs/domain_catalog.md`) sladit seznam domén s tím, co je v:
     - `data/schema/domains.json`
     - novém skriptu `fix_create_intent_runtime_dirs.py`
     - `_source/domains/**`
   - Ideálně:
     - držet jeden „zdroj pravdy“ pro seznam domén (např. `data/schema/domains.json`),
     - skript `fix_create_intent_runtime_dirs.py` generovat z tohoto zdroje (do budoucna).
   - Pro teď je OK „natvrdo“, ale doporučuji do komentáře ve skriptu přidat TODO:

     ```python
     # TODO: v budoucnu načítat seznam domén z data/schema/domains.json
     ```

3. **Test na existenci runtime adresářů**
   - Přidat jednoduchý test (např. `tests/test_intent_runtime_dirs.py`), který:
     - spustí `ensure_runtime_intent_dirs` (ideálně refaktorovat do samostatné funkce, jak výše),
     - ověří, že pro každou doménu existuje `data/intents/&lt;domain&gt;/.keep`.
   - Tím se rychle zachytí případné přejmenování domény nebo změnu seznamu bez úpravy skriptu.

---

### 4. Co není úplně jasné / na co bych se doptal

1. **Zdroj pravdy pro seznam domén**
   - Má být finálním zdrojem `data/schema/domains.json`, nebo kombinace s `runtime/domain_catalog.py`?
   - Má nový skript dlouhodobě číst domény z jednoho centrálního schématu, nebo má zůstat „natvrdo“?

2. **Pipeline pro generování `data/intents/**`**
   - Jak přesně se nyní generují runtime intent JSONy z `_source/domains/**`?
     - `tools/generate_intent_from_domains.py` vs. `tools/generate_intents_from_yaml.py` vs. `tools/bootstrap_traffic_law_intents.py`.
   - Bude se `fix_create_intent_runtime_dirs.py` volat jen v CI, nebo i lokálně (např. `make bootstrap-intents`)?

Po zodpovězení těchto dvou bodů by šlo:
- skript napojit na jednotný doménový katalog,
- doplnit dokumentaci tak, aby vývojář jasně chápal tok: `_source` → generace → `data/intents` → načtení enginem.
================================================================================
Run type : FIX
Timestamp (UTC) : 2025-11-29T19:00:55Z
Task : Automatický bootstrap intentů pro traffic_law + sanity test
------------------------------------------------------------------------

Vytvořen/aktualizován: tools/bootstrap_traffic_law_intents.py
Vytvořen/aktualizován: tests/test_intent_loader_runtime_minimal.py
Vygenerované/aktualizované runtime intenty v data/intents/traffic_law: (žádné nové, jen přepsáno)
</pre>
</body>
</html>
