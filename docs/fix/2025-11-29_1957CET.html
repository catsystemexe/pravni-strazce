<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Právní strážce – FIX run (2025-11-29T18:57:09Z)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 2rem;
            line-height: 1.5;
            background: #0f172a;
            color: #e5e7eb;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #020617;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid #1f2937;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .meta {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-bottom: 0.5rem;
        }

    </style>
</head>
<body>
    <h1>Právní strážce – FIX run</h1>
    <div class="meta">
      Tento soubor generuje GitHub Action z repozitáře catsystemexe/pravni-strazce.
      (UTC: 2025-11-29T18:57:09Z)
    </div>
    <pre>================================================================================
ODPOVĚĎ CODING AGENTA:

## 1. Co chápu ze struktury projektu

- Jádro: AI framework „Právní strážce“ s orchestrátorem (`runtime/orchestrator.py`), enginy (`engines/*`) a společnými typy.
- Domény a intent data:
  - Zdrojová data domén jsou v `data/_source/domains/&lt;domain&gt;/...` (např. `traffic_law` už má rozpadlé intents).
  - Validace a generování runtime intentů probíhá přes nástroje v `tools/` (`generate_intents_from_yaml.py`, `validate_intents.py` atd.).
  - Runtime engine pro intenty (`engines/intent`) načítá JSON soubory z `data/intents/**` a používá je pro heuristickou klasifikaci.
- Pravidla domén (`engines/domain_rules/*.yaml`) jsou dnes jen pro část českých domén (civil, správní, rodinné, apod.).
- LLM podpora je v `llm/`, výstupní šablony v `templates/`, produktové konfigurace v `product/`.
- V adresáři `data/` zatím chybí `data/intents/` (resp. není vylistován žádný obsah), což je důležité pro intent engine a aktuální úkol.

---

## 2. Konkrétní návrh kroků pro splnění úkolu (.keep, adresáře, idempotence)

Tyto kroky jsou pro vývojáře – ty máš provést v repozitáři (ručně nebo skriptem). Já soubory nevytvářím.

### 2.1 Přehled požadovaného výsledku

- Musí existovat adresář:
  - `data/intents/`
- Pro každou doménu musí existovat:
  - adresář `data/intents/&lt;domain&gt;/`
  - prázdný soubor `data/intents/&lt;domain&gt;/.keep` (0 bajtů)
- Operace má být idempotentní – tedy opakované spuštění nic nerozbije:
  - adresáře, které už existují, se nemění,
  - `.keep`, pokud existuje, se nepřepisuje.

### 2.2 Doporučený postup (shell / Unix)

1. Vytvořit root adresář pro runtime intenty:

   ```bash
   mkdir -p data/intents
   ```

2. Definovat seznam domén (přesně dle zadání):

   ```bash
   DOMAINS=(
     school_law
     debt_law
     environmental_law
     property_construction_law
     social_law
     media_ip_law
     constitutional_law
     family_law
     data_digital_law
     labor_law
     health_law
     tax_law
     administrative_law
     inheritance_law
     criminal_law
     traffic_law
     corporate_law
     civil_law
     consumer_finance_law
     international_law
   )
   ```

3. Pro každou doménu zajistit adresář a `.keep`, idempotentně:

   ```bash
   for d in &quot;${DOMAINS[@]}&quot;; do
     # 1) založit adresář domény
     mkdir -p &quot;data/intents/$d&quot;

     # 2) pokud .keep neexistuje, vytvořit prázdný soubor
     if [ ! -f &quot;data/intents/$d/.keep&quot; ]; then
       # POSIX-safe vytvoření prázdného souboru
       : &gt; &quot;data/intents/$d/.keep&quot;
     fi
   done
   ```

   - `mkdir -p` je idempotentní (nevadí opakované volání).
   - `: &gt; file` vytvoří nový prázdný soubor; díky `if [ ! -f ... ]` se to spustí jen pokud soubor neexistuje (aby se nic nepřepisovalo).

### 2.3 Doporučený Python skript (např. do `tools/fix_create_intent_runtime_dirs.py`)

Pokud chcete mít fix jako maintainable nástroj:

1. Vytvořit skript (návrh obsahu):

   ```python
   # tools/fix_create_intent_runtime_dirs.py
   from __future__ import annotations
   import os
   from pathlib import Path

   REPO_ROOT = Path(__file__).resolve().parents[1]
   BASE_DIR = REPO_ROOT / &quot;data&quot; / &quot;intents&quot;

   DOMAINS = [
       &quot;school_law&quot;,
       &quot;debt_law&quot;,
       &quot;environmental_law&quot;,
       &quot;property_construction_law&quot;,
       &quot;social_law&quot;,
       &quot;media_ip_law&quot;,
       &quot;constitutional_law&quot;,
       &quot;family_law&quot;,
       &quot;data_digital_law&quot;,
       &quot;labor_law&quot;,
       &quot;health_law&quot;,
       &quot;tax_law&quot;,
       &quot;administrative_law&quot;,
       &quot;inheritance_law&quot;,
       &quot;criminal_law&quot;,
       &quot;traffic_law&quot;,
       &quot;corporate_law&quot;,
       &quot;civil_law&quot;,
       &quot;consumer_finance_law&quot;,
       &quot;international_law&quot;,
   ]

   def main() -&gt; None:
       # 1) data/intents/
       BASE_DIR.mkdir(parents=True, exist_ok=True)

       for dom in DOMAINS:
           dom_dir = BASE_DIR / dom
           keep_path = dom_dir / &quot;.keep&quot;

           # 2) adresář domény (idempotentní)
           dom_dir.mkdir(exist_ok=True)

           # 3) .keep – vytvořit jen pokud neexistuje
           if not keep_path.exists():
               keep_path.touch()  # vytvoří 0-byte soubor

   if __name__ == &quot;__main__&quot;:
       main()
   ```

2. Spuštění z rootu projektu:

   ```bash
   python tools/fix_create_intent_runtime_dirs.py
   ```

3. Ověření:

   ```bash
   ls -R data/intents
   # a případně velikost .keep
   find data/intents -name &quot;.keep&quot; -exec ls -l {} \;
   ```

---

## 3. Návrhy na vylepšení architektury / dokumentace kolem intentů a domén

### 3.1 Propojení `_source` a runtime `data/intents/`

- Dnes:
  - zdrojové definice v `data/_source/domains/&lt;domain&gt;/**`,
  - runtime adresář `data/intents/` je čtecí endpoint pro `engines/intent.loader`.
- Doporučení:
  1. Do `docs/intent.system.md` doplnit sekci „Runtime adresáře intentů“:
     - vysvětlit, že `data/intents/&lt;domain&gt;/*.json` vznikají generováním z `_source` nebo bootstrap skriptů,
     - že `.keep` drží prázdné domény v gitu, dokud nejsou definované první JSONy.
  2. Do `tools/generate_intents_from_yaml.py` (a podobných) přidat konstantu/konfiguraci pro `BASE_RUNTIME_INTENTS_DIR = data/intents` a explicitně zkontrolovat, zda doménový adresář existuje; pokud ne, vytvořit ho (respektuje tímto fix).

### 3.2 Validace doménového katalogu vs runtime dirs

- V `data/schema/domains.json` pravděpodobně existuje master seznam domén (není vypsán obsah).
- Doporučení:
  1. Vytvořit v `tools/validate_data.py` check:
     - pro každou doménu v `domains.json`:
       - existuje `data/_source/domains/&lt;domain&gt;`?
       - existuje `data/intents/&lt;domain&gt;` a `.keep` nebo alespoň adresář?
  2. V CI (pokud existuje) spouštět `python tools/validate_data.py` a failnout, pokud chybí adresář pro nějakou doménu (pomáhá předcházet regresím typu „nová doména v katalogu, ale nejsou runtime dirs“).

### 3.3 Úprava intent engine dokumentace

- `engines/intent/loader.py` a `engines/intent/engine.py` spoléhají na `data/intents/**.json`.
- Návrhy:
  1. V `docs/intent.system.md` doplnit:
     - „Intent engine čte pouze JSON soubory v `data/intents/**`; absence adresáře domény znamená, že heuristika pro tuto doménu zatím nebude mít žádné signály.“
  2. Do `engines/intent/loader.py` doplnit krátký modul-level docstring s popisem:
     - kde očekává soubory,
     - že prázdné doménové adresáře s `.keep` jsou v pořádku (jen žádné intenty nenajde).

---

## 4. Co není (z tohoto výpisu) úplně jasné

1. Obsah `data/schema/domains.json`:
   - není vidět, jak přesně jsou domény pojmenované (předpokládám shodu s názvy složek).
   - pro 100% robustní nástroj by bylo dobré čerpat seznam domén právě z tohoto JSONu, ne z hard-coded listu.

2. Napojení generátorů:
   - `tools/generate_intent_from_domains.py` a `tools/bootstrap_traffic_law_intents.py` – není jasné, jak přesně se dnes používají a zda očekávají existenci `data/intents/&lt;domain&gt;/`.
   - doporučuji po implementaci tohoto fixu tyto skripty otevřít a případně:
     - doplnit `mkdir -p data/intents/&lt;domain&gt;` před zápisem,
     - nebo parametrizovat výstupní cestu.

Pokud dodáš obsah `data/schema/domains.json` a případně ukázku některého z `tools/generate_*.py`, můžu navrhnout ještě přesnější úpravy, aby se fix plně integroval do celého data-pipeline.
================================================================================
Run type : FIX
Timestamp (UTC) : 2025-11-29T18:57:09Z
Task : Automatický bootstrap intentů pro traffic_law + sanity test
------------------------------------------------------------------------

Vytvořen/aktualizován: tools/bootstrap_traffic_law_intents.py
Vytvořen/aktualizován: tests/test_intent_loader_runtime_minimal.py
Vygenerované/aktualizované runtime intenty v data/intents/traffic_law: (žádné nové, jen přepsáno)
</pre>
</body>
</html>
