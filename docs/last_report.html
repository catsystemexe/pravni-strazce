<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Právní strážce – poslední report agenta</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 2rem;
            line-height: 1.5;
            background: #0f172a;
            color: #e5e7eb;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #020617;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid #1f2937;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .meta {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-bottom: 0.5rem;
        }

    </style>
</head>
<body>
    <h1>Právní strážce – poslední report agenta</h1>
    <div class="meta">
      Tento soubor generuje GitHub Action z repozitáře catsystemexe/pravni-strazce.
    </div>
    <pre>================================================================================
ODPOVĚĎ CODING AGENTA:

- Chápu, že projekt je jádrem rámce „Právní strážce“ s modulární architekturou:
  - `runtime` orchestruje enginy.
  - Různé `engines/*` řeší dílčí úlohy (core_legal, judikatura, risk, intent…).
  - Doménová a intent data jsou v `data/_source/...` a pravděpodobně se generují do runtime struktury (`data/intents`, `data/schema/...`).
  - Pro intents existuje engine (`engines/intent/engine.py`) a loader (`engines/intent/loader.py`), který čte JSONy z `data/intents`.
  - Testy v `tests/` validují orchestrátor, domain rules, core_legal, generování intentů z YAML atd.

---

## 1. Nejasnosti / chybějící kontext

- V repu není vypsán obsah adresáře `data/intents/` (jen `_source`), ale:
  - `tools/generate_intents_from_yaml.py` a `tools/bootstrap_traffic_law_intents.py` naznačují, že se z `_source/domains/...` generují runtime JSONy právě do `data/intents`.
  - Test, který máš vytvořit, má jen ověřit, že něco existuje, a že mezi doménami je `traffic_law`. To znamená:
    - Předpokládá se, že v CI buď běží generátor před testy, nebo už je `data/intents` verzovaná v Gitu.
- Nemám teď obsah `tests/test_intent_loader_runtime_minimal.py` (jestli už existuje, nebo je nový).

To není blokující; test lze napsat tak, aby selhal pouze v případě, že:
- `load_intents()` vrací prázdný seznam nebo
- mezi `domain` hodnotami není `traffic_law`.

---

## 2. Konkrétní návrh změn v rámci úkolu

### 2.1. Pomocný test: `tests/test_intent_loader_runtime_minimal.py`

Cíl:
- Importovat `load_intents` z `engines.intent.loader`.
- Zavolat `load_intents()`.
- Ověřit:
  - že seznam je neprázdný,
  - že `traffic_law` je mezi hodnotami `domain`.

Navrhovaný obsah souboru (přepsat / vytvořit):

```python
# tests/test_intent_loader_runtime_minimal.py

from engines.intent.loader import load_intents


def test_load_intents_returns_non_empty_list_and_contains_traffic_law():
    intents = load_intents()

    # 1) musí vrátit neprázdný seznam
    assert isinstance(intents, list)
    assert len(intents) &gt; 0, &quot;load_intents() by měl načíst alespoň jeden intent&quot;

    # 2) zjistit domény z načtených IntentDefinition
    domains = {intent.domain for intent in intents}

    # 3) ověřit, že mezi doménami je &#x27;traffic_law&#x27;
    assert &quot;traffic_law&quot; in domains, (
        &quot;Mezi načtenými intents by měla být doména &#x27;traffic_law&#x27;. &quot;
        &quot;Zkontroluj, zda jsou v data/intents vygenerovány traffic_law JSONy.&quot;
    )
```

Tento test:
- nepoužívá žádné vedlejší efekty,
- nevyžaduje žádnou další konfiguraci, jen existenci `data/intents` s alespoň jedním JSONem, který má `domain=&quot;traffic_law&quot;`.

---

## 3. Drobný komentář k architektuře intent loaderu

Zadání výslovně říká „Nic jiného v projektu neměň“, takže změny do `engines/intent/loader.py` nebudu navrhovat jako povinné, jen jako doporučení do budoucna:

1. **BASE_DIR relativně vůči rootu**  
   - Dnes: `BASE_DIR = os.path.join(&quot;data&quot;, &quot;intents&quot;)`.  
   - To spoléhá na current working directory. Robustnější by bylo odvíjet cestu od `__file__` nebo od centrální konstanty (`REPO_ROOT` v `coding_agent.py` ukazuje, jak to děláte jinde).

2. **Volitelný parametr pro vlastní cestu**  
   - Pro testování by se hodilo, aby `load_intents(base_dir: str | Path = BASE_DIR)` umožnil testům mířit na fixture adresář, ale zadání explicitně omezuje změny, takže teď jen doporučení.

3. **Lepší logování chyb**  
   - Místo `print` by se později mohlo použít `logging`, případně sběr statistik (kolik souborů, kolik chyb).

---

## 4. Doporučené kroky pro vývojáře

1. **Zkontrolovat stav `data/intents` v repozitáři**  
   - Ověřit, zda jsou JSONy s `domain: &quot;traffic_law&quot;` verzované a dostupné při běhu testů.  
   - Pokud ne, zajistit, aby CI před testy spouštěla např. `python tools/generate_intents_from_yaml.py` nebo `python tools/bootstrap_traffic_law_intents.py`.

2. **Vytvořit / upravit `tests/test_intent_loader_runtime_minimal.py`**  
   - Použít výše uvedený obsah.  
   - Spustit `pytest -k intent_loader_runtime_minimal` a zkontrolovat, že:
     - test proběhne bez chyb,
     - v případě prázdného `data/intents` dává srozumitelné chybové hlášení.

3. **(Volitelně do budoucna) Centralizovat kořen dat**  
   - Zvážit zavedení modulu typu `runtime.paths` nebo konfigurace v `runtime/config_loader.py`, která bude určovat, kde jsou runtime data (`data/intents`, `data/schema`, `data/_source`), aby se cesty nemusely skládat ručně v každém engine.

Pokud mi poskytneš obsah případného stávajícího `tests/test_intent_loader_runtime_minimal.py` nebo strukturu `data/intents`, mohu návrh testu ještě přesněji sladit s aktuálním stylem projektu (např. použití fixtur v `conftest.py`).
================================================================================
Run type : FIX
Timestamp (UTC) : 2025-11-29T17:41:29Z
Task : Automatický bootstrap intentů pro traffic_law + sanity test
------------------------------------------------------------------------

Vytvořen/aktualizován: tools/bootstrap_traffic_law_intents.py
Vytvořen/aktualizován: tests/test_intent_loader_runtime_minimal.py
Vygenerované/aktualizované runtime intenty v data/intents/traffic_law: (žádné nové, jen přepsáno)
</pre>
</body>
</html>
