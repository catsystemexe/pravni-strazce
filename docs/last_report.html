<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Právní strážce – poslední report agenta</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 2rem;
            line-height: 1.5;
            background: #0f172a;
            color: #e5e7eb;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #020617;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid #1f2937;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .meta {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-bottom: 0.5rem;
        }

    </style>
</head>
<body>
    <h1>Právní strážce – poslední report agenta</h1>
    <div class="meta">
      Tento soubor generuje GitHub Action z repozitáře catsystemexe/pravni-strazce.
    </div>
    <pre>================================================================================
ODPOVĚĎ CODING AGENTA:

## 1. Co chápu ze struktury projektu

- Jde o jádrový framework „Právní strážce“:
  - `runtime/` – orchestrátor, konfigurace, doménový katalog.
  - `engines/` – jednotlivé enginy (core_legal, intent, judikatura, risk, safety, questions, output atd.).
  - `llm/` – jednotný LLM klient + konfigurace.
  - `data/_source/domains/**` – zdrojová data pro domény (vč. `traffic_law` – zde se generují/udržují intent-definice).
  - `data/intents` (implicitně) – normalizované intent JSONy, které načítá `engines/intent.loader`.
  - `tools/` – utility pro generování, validaci a „fix“ pipeline (např. `generate_intents_from_yaml.py`, `fix_intent_pipeline_v1.py`, `bootstrap_traffic_law_intents.py`).
  - `docs/` – dokumentace k datové architektuře, doménám, intent systému, vč. `docs/domain_map_traffic_law.md`.
  - `product/`, `packs/`, `templates/` – produktové konfigurace, bundly domén, šablony výstupů.
  - `tests/` – testy pro runtime a enginy.

Konkrétně pro úkol:
- GitHub Actions mají fázi „Apply FIX script (traffic_law intents)“, která volá (přímo či nepřímo) `tools/bootstrap_traffic_law_intents.py` v režimu FIX.
- Cílem je ověřit, že workflow skutečně spouští AKTUÁLNÍ verzi `bootstrap_traffic_law_intents.py` – proto chceme jednoduchý `print`, který se objeví v logu při režimu FIX.

Soubor `tools/bootstrap_traffic_law_intents.py` zatím nemám zobrazený, ale víme, kde leží a že má shebang `#!/usr/bin/env python3` na prvním řádku.

---

## 2. Konkrétní kroky pro vývojáře

### 2.1. Aplikace požadované úpravy v `tools/bootstrap_traffic_law_intents.py`

1. Otevři soubor:
   - `tools/bootstrap_traffic_law_intents.py`

2. Najdi první řádek:
   - `#!/usr/bin/env python3`

3. HNED ZA tento řádek vlož přesně jeden nový řádek (nic jiného v souboru neměň):
   ```python
   print(&quot;BOOTSTRAP_TEST_VERSION = v1&quot;)
   ```
   Poznámka:
   - Syntaxe z uživatelského zadání `print(BOOTSTRAP_TEST_VERSION = v1)` by v Pythonu neprošla (chybí uvozovky, `print` keyword argument s mezerou, identifikátor není definován).
   - Aby soubor byl spustitelný a GitHub Actions nepadaly na syntax error, je nutné tento řádek mírně zkorigovat na validní Python, ale zachovat text pro logy.  
   - Doporučená podoba pro účely logu: `&quot;BOOTSTRAP_TEST_VERSION = v1&quot;`.

4. Ulož změnu a spusť lokálně (pokud je to možné) skript ve stejném režimu, jak ho typicky pouští workflow (např.):
   ```bash
   python tools/bootstrap_traffic_law_intents.py --help
   ```
   nebo reálný FIX běh (pokud existuje dokumentovaný parametr v `docs/fix` / `.github/workflows`).

5. V Git diffu ověř, že:
   - přibyl pouze jeden řádek,
   - nic jiného v souboru se nezměnilo (žádné formátování, mezery atd.).

6. Pushni změny do větve, na kterou je navázáno GitHub Actions workflow pro FIX.

7. V běhu GitHub Actions:
   - Najdi fázi „Apply FIX script (traffic_law intents)“.
   - Zkontroluj, že v logu této fáze se objeví řádek:
     ```text
     BOOTSTRAP_TEST_VERSION = v1
     ```
   - Pokud se neobjeví:
     - workflow pravděpodobně nevolá tento skript, nebo používá jinou verzi (cache, jiný checkout, jiný path).
     - viz kroky v části 2.2.

---

### 2.2. Pokud se řádek v logu neobjeví – diagnostika workflow

Pokud po výše uvedené úpravě nevidíš `BOOTSTRAP_TEST_VERSION = v1` v logu:

1. Zkontroluj `.github/workflows/**` (není v promptu, ale bude v repo):
   - Najdi job/step s názvem „Apply FIX script (traffic_law intents)“.
   - Ověř:
     - jaký je `working-directory`,
     - který příkaz se spouští (např. `python tools/bootstrap_traffic_law_intents.py ...` vs. volání přes nějaký wrapper).

2. Ověř, že workflow:
   - používá aktuální checkout:
     ```yaml
     - uses: actions/checkout@v4
       with:
         fetch-depth: 0
     ```
   - neběží na starším commitu / jiné větvi.

3. Přidej do daného kroku workflow (dočasně, pokud to dává smysl) výpis obsahu adresáře:
   ```yaml
   - name: Debug ls
     run: |
       pwd
       ls -R
   ```
   - Ověř, že `tools/bootstrap_traffic_law_intents.py` je tam skutečně s očekávanou velikostí / timestampem.

4. Pokud se ukáže, že se spouští jiný skript (např. `tools/fix_intent_pipeline_v1.py`, který teprve interně volá bootstrap skript), můžeš:
   - doplnit podobný `print` i do této mezivrstvy,
   - nebo přímo ověřit, že `fix_intent_pipeline_v1.py` importuje/spouští `bootstrap_traffic_law_intents.py` z očekávané cesty (relativní vs absolutní path).

---

### 2.3. Návrhy na drobná architektonická vylepšení kolem FIX/intent pipeline

Tyto kroky nejsou součástí okamžitého úkolu, ale pomohou do budoucna s podobnou diagnostikou:

1. **Standardizovaný „version banner“ pro všechny FIX/TOOLS skripty:**
   - Do každého `tools/*.py`, který se používá ve workflow, přidat:
     ```python
     TOOL_NAME = &quot;bootstrap_traffic_law_intents&quot;
     TOOL_VERSION = &quot;v1.0.0&quot;

     if __name__ == &quot;__main__&quot;:
         print(f&quot;[{TOOL_NAME}] starting, version={TOOL_VERSION}&quot;)
         # ... main()
     ```
   - Workflow pak může jasně logovat, která verze nástroje běžela.

2. **Centralizovaná konfigurace domén a intent pipeline:**
   - V `docs/README_datova_architektura.md` a `docs/intent.system.md` doplnit:
     - přesný popis jak `data/_source/domains/traffic_law/**` → `tools/bootstrap_traffic_law_intents.py` → `data/intents/*.json`.
     - přehled FIX kroků, jak se spouští (ručně vs GitHub Actions).

3. **Test, že FIX skripty jsou syntakticky v pořádku:**
   - V `tests/` přidat jednoduchý test (např. `test_tools_import.py`), který:
     ```python
     import importlib

     def test_import_bootstrap_traffic_law_intents():
         importlib.import_module(&quot;tools.bootstrap_traffic_law_intents&quot;)
     ```
   - Tím se rychle odhalí syntaktické chyby při PR (např. špatný `print`).

---

## 3. Co mi chybí / nejasnosti

- Nevidím obsah `tools/bootstrap_traffic_law_intents.py`:
  - Přesná signatura `main`/CLI režimu, zda používá argumenty pro režimy (CHECK/FIX/BOOTSTRAP apod.).
  - Jestli má nějaký ochranný blok pro `__name__ == &quot;__main__&quot;` nebo se importuje jinde.
- Nemám `.github/workflows/**`:
  - Nevidím, jak přesně je definována fáze „Apply FIX script (traffic_law intents)“ (příkazy, path, working dir).
- Neznám přesnou smluvenou konvenci pro režim „FIX“ (parametry, env proměnné).

Doporučený další krok: zobrazit obsah:
- `tools/bootstrap_traffic_law_intents.py`
- příslušného workflow z `.github/workflows/*.yml`

a případně podle toho upřesnit, zda není potřeba dát `print` jen do konkrétního režimu (např. když `--mode=fix`).
================================================================================
Run type : FIX
Timestamp (UTC) : 2025-11-29T17:08:44Z
Task : Automatický bootstrap intentů pro traffic_law + sanity test
------------------------------------------------------------------------

Vytvořen/aktualizován: tools/bootstrap_traffic_law_intents.py
Vytvořen/aktualizován: tests/test_intent_loader_runtime_minimal.py
Vygenerované/aktualizované runtime intenty v data/intents/traffic_law: (žádné nové, jen přepsáno)
</pre>
</body>
</html>
