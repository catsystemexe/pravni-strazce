<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Právní strážce – poslední report agenta</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 2rem;
            line-height: 1.5;
            background: #0f172a;
            color: #e5e7eb;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #020617;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid #1f2937;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .meta {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-bottom: 0.5rem;
        }

    </style>
</head>
<body>
    <h1>Právní strážce – poslední report agenta</h1>
    <div class="meta">
      Tento soubor generuje GitHub Action z repozitáře catsystemexe/pravni-strazce.
    </div>
    <pre>================================================================================
ODPOVĚĎ CODING AGENTA:

## 1. Co chápu ze struktury projektu

- Repo je core backend pro „Právní strážce“ s jasně oddělenými vrstvami:
  - `engines/*` – funkční logika (intent, core_legal, risk, …).
  - `runtime/*` – orchestrátor a pipeline.
  - `llm/*`, `prompts/*`, `templates/*` – LLM a šablony výstupů.
  - `data/` – datová vrstva:
    - `data/intents/` – runtime JSON pro intent engine.
    - `data/_source/` – zdrojová, „master“ data domén a intentů.
    - `data/_source/_template/intent_template.json` – šablona pro nové intenty.
    - `data/_source/domains/` – per‑doménová data (části mají už `intents/` podadresář, např. `traffic_law`).

Tvůj konkrétní úkol je „FIX“ čistě v `data/_source/domains`: pro každou existující doménu zajistit
- podadresář `intents/`
- a v něm `README.md` placeholder (pokud neexistuje).

---

## 2. Analýza konkrétní situace v `data/_source/domains`

Z výpisu struktury vyplývá, že aktuálně existují tyto doménové složky:

1. `school_law`
2. `debt_law`
3. `environmental_law`
4. `property_construction_law`
5. `social_law`
6. `media_ip_law`
7. `constitutional_law`
8. `family_law`
9. `data_digital_law`
10. `labor_law`
    - má soubor `labor_termination.json` přímo v kořeni domény
    - nemá podadresář `intents/` (v seznamu nevidím)
11. `health_law`
12. `tax_law`
13. `administrative_law`
    - má `appeal_admin_decision.json` v kořeni domény
14. `inheritance_law`
15. `criminal_law`
    - má `criminal_defense.json` v kořeni domény
16. `traffic_law`
    - má `domain.yaml`, `subdomains.yaml`, `readme.md`
    - má `intents/` s více JSON soubory (již ve správné cílové struktuře)
17. `corporate_law`
18. `civil_law`
19. `consumer_finance_law`
    - má `consumer_credit.json` v kořeni domény
20. `international_law`

Z toho plyne:

- Požadavek 1 (najít domény) je jasný: pracujeme přesně s těmito 20 složkami.
- Požadavek 2–3: `traffic_law` už `intents/` má, ostatní zatím ne (minimálně nejsou ve výpisu).
- U žádné domény kromě `traffic_law` nevidím `intents/` – tedy je velmi pravděpodobné, že je potřeba je vytvořit pro 19 domén.
- V žádném `intents/` kromě `traffic_law` (a ani tam) nevidím README, tzn.:
  - pro `traffic_law/intents/` ověřit existenci `README.md` – ve výpisu není, takže jej bude třeba vytvořit,
  - pro nově zakládané `intents/` u ostatních domén také založit `README.md`.

Co mi chybí / co je potřeba si na straně vývojáře ověřit při implementaci:
- Zda se na disku skutečně nenachází nějaké `intents/` podadresáře nebo README, které nejsou ve zkráceném výpisu (ale podle poskytnuté struktury budeme vycházet z toho, že nejsou).

---

## 3. Návrh konkrétních kroků pro vývojáře

### 3.1. Vytvoření standardizované struktury domén (`intents/` + README)

1. **Vylistovat existující domény**

   Na rootu repa:

   ```bash
   cd path/to/repo

   ls data/_source/domains
   ```

   Očekávaný seznam (musí odpovídat výpisu, ale bere se reálný stav disku):

   - `school_law`
   - `debt_law`
   - `environmental_law`
   - `property_construction_law`
   - `social_law`
   - `media_ip_law`
   - `constitutional_law`
   - `family_law`
   - `data_digital_law`
   - `labor_law`
   - `health_law`
   - `tax_law`
   - `administrative_law`
   - `inheritance_law`
   - `criminal_law`
   - `traffic_law`
   - `corporate_law`
   - `civil_law`
   - `consumer_finance_law`
   - `international_law`

2. **Pro každou doménu zajistit adresář `intents/` (idempotentně)**

   V shellu lze použít:

   ```bash
   for d in data/_source/domains/*; do
       [ -d &quot;$d&quot; ] || continue
       mkdir -p &quot;$d/intents&quot;
   done
   ```

   - `mkdir -p` je idempotentní – opakované spuštění nemění existující strukturu.

3. **Vytvořit README.md placeholder tam, kde chybí**

   Skript v shellu:

   ```bash
   for d in data/_source/domains/*; do
       [ -d &quot;$d&quot; ] || continue
       intents_dir=&quot;$d/intents&quot;
       readme=&quot;$intents_dir/README.md&quot;

       if [ ! -f &quot;$readme&quot; ]; then
           domain_code=&quot;$(basename &quot;$d&quot;)&quot;
           cat &gt; &quot;$readme&quot; &lt;&lt;EOF
# Intenty pro doménu ${domain_code}

Tento adresář je určen pro zdrojové definice intentů domény ${domain_code} ve formátu JSON/YAML. Zatím zde nejsou žádné konkrétní intent definice – jde pouze o placeholder pro budoucí práci.
EOF
       fi
   done
   ```

   - Podmínka `if [ ! -f &quot;$readme&quot; ]` zajistí, že případné existující README se **nepřepíše**.
   - Obsah je sjednocený s textem z úkolu (pouze dosazen `&lt;domain_code&gt;`).

4. **Nezasahovat mimo `data/_source/domains`**

   - Nepřesouvat existující `.json` soubory (`labor_termination.json`, `criminal_defense.json` atd.) – úkol se výslovně omezuje jen na vytvoření adresářů a README placeholderů.
   - Nic neměnit v `data/intents/`, `engines/`, `runtime/`, `docs/` atd.
   - Nesahej na `domain.yaml`, `subdomains.yaml` či existující intent JSON/YAML.

5. **(Volitelně) Připravit malý Python util skript pro opakované použití**

   Pokud preferujete Python:

   ```python
   # tools/fix_domains_intents_dirs.py  (návrh umístění)

   from pathlib import Path

   ROOT = Path(__file__).resolve().parents[1]
   DOMAINS_ROOT = ROOT / &quot;data&quot; / &quot;_source&quot; / &quot;domains&quot;

   def main() -&gt; None:
       created_dirs = []
       created_readmes = []

       for domain_dir in DOMAINS_ROOT.iterdir():
           if not domain_dir.is_dir():
               continue

           intents_dir = domain_dir / &quot;intents&quot;
           if not intents_dir.exists():
               intents_dir.mkdir(parents=True, exist_ok=True)
               created_dirs.append(domain_dir.name)

           readme = intents_dir / &quot;README.md&quot;
           if not readme.exists():
               content = (
                   f&quot;# Intenty pro doménu {domain_dir.name}\n\n&quot;
                   f&quot;Tento adresář je určen pro zdrojové definice intentů &quot;
                   f&quot;domény {domain_dir.name} ve formátu JSON/YAML. &quot;
                   f&quot;Zatím zde nejsou žádné konkrétní intent definice – jde &quot;
                   f&quot;pouze o placeholder pro budoucí práci.\n&quot;
               )
               readme.write_text(content, encoding=&quot;utf-8&quot;)
               created_readmes.append(domain_dir.name)

       # Jednoduchý report do stdout
       print(f&quot;Domains found: {len(list(DOMAINS_ROOT.iterdir()))}&quot;)
       print(&quot;created intents dir:&quot;, &quot;, &quot;.join(created_dirs) or &quot;(none)&quot;)
       print(&quot;created README:&quot;, &quot;, &quot;.join(created_readmes) or &quot;(none)&quot;)


   if __name__ == &quot;__main__&quot;:
       main()
   ```

   - Při nasazení do repa byste tento skript spustili jednorázově i opakovaně; díky kontrole existence je plně idempotentní.

---

## 4. FIX report – očekávaný výsledek (pro ruční kontrolu)

Na základě aktuálně viditelné struktury (a předpokladu, že žádné další `intents/` ani README neexistují) by po spuštění výše uvedeného postupu měl report vypadat zhruba takto:

- **Počet nalezených domén**: 20

- **created intents dir:**
  - `school_law`
  - `debt_law`
  - `environmental_law`
  - `property_construction_law`
  - `social_law`
  - `media_ip_law`
  - `constitutional_law`
  - `family_law`
  - `data_digital_law`
  - `labor_law`
  - `health_law`
  - `tax_law`
  - `administrative_law`
  - `inheritance_law`
  - `criminal_law`
  - `traffic_law` (u vás již existuje – zde záleží na skutečném stavu; `mkdir -p` nic nemění)
  - `corporate_law`
  - `civil_law`
  - `consumer_finance_law`
  - `international_law`

- **created README:**
  - `school_law`
  - `debt_law`
  - `environmental_law`
  - `property_construction_law`
  - `social_law`
  - `media_ip_law`
  - `constitutional_law`
  - `family_law`
  - `data_digital_law`
  - `labor_law`
  - `health_law`
  - `tax_law`
  - `administrative_law`
  - `inheritance_law`
  - `criminal_law`
  - `traffic_law`
  - `corporate_law`
  - `civil_law`
  - `consumer_finance_law`
  - `international_law`

Reálný report by se měl vygenerovat přímo skriptem (viz Python varianta výše), aby sloužil jako auditní stopa pro tento FIX.

---

## 5. Co může být v dalším kroku (mimo aktuální FIX)

Není součástí tohoto úkolu, ale z hlediska architektury dat doporučuji pro budoucno:

1. **Dokumentace standardu pro `data/_source/domains/*/intents`**
   - Rozšířit `docs/README_datova_architektura.md` o kapitolu:
     - kde se explicitně popíše, že:
       - `data/_source/domains/&lt;domain&gt;/intents/*.json|*.yaml` jsou zdrojové definice,
       - pipeline (např. `tools/generate_intents_from_yaml.py`) generuje z těchto dat sjednocené `data/intents/*.json` pro runtime.

2. **Postupná migrace existujících `.json` v kořeni domén do `intents/`**
   - Např. `labor_law/labor_termination.json` → `labor_law/intents/…`, ale to je samostatný úkol.

Pokud potřebuješ, můžu v dalším kroku navrhnout přesnou konvenci názvů souborů a propojení s `tools/generate_intents_from_yaml.py`.
================================================================================
Run type : FIX
Timestamp (UTC) : 2025-11-29T18:30:02Z
Task : Automatický bootstrap intentů pro traffic_law + sanity test
------------------------------------------------------------------------

Vytvořen/aktualizován: tools/bootstrap_traffic_law_intents.py
Vytvořen/aktualizován: tests/test_intent_loader_runtime_minimal.py
Vygenerované/aktualizované runtime intenty v data/intents/traffic_law: (žádné nové, jen přepsáno)
</pre>
</body>
</html>
